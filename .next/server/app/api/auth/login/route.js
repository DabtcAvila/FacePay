"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},74381:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>q,patchFetch:()=>j,requestAsyncStorage:()=>k,routeModule:()=>A,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var a={};t.r(a),t.d(a,{GET:()=>v,POST:()=>x,dynamic:()=>h});var i=t(49303),o=t(88716),n=t(60670),s=t(13538),u=t(75183),d=t(2095),l=t(62065),c=t(1741),p=t(89557),g=t(43258);let h="force-dynamic";async function m(e){try{if((0,p.k_)(e).shouldBlock)return(0,d.jl)("Request blocked due to security concerns",403);let r=await (0,c._D)(e);if(r.error)return r.error;let{email:t,password:a}=r.data,i=await s._.user.findUnique({where:{email:t},select:{id:!0,email:!0,name:!0,createdAt:!0,updatedAt:!0}});if(!i)return(0,p.Ak)(e,"User not found",void 0),(0,g.Aj)(f(e)),(0,d.jl)("Invalid credentials",401);let o=p.kx.analyzeUserBehavior(i.id,e);o.riskScore>5&&(0,p.Ak)(e,`Anomalous login behavior detected: ${o.anomalies.join(", ")}`,i.id);let n=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),l=(0,u.X8)(i);return(0,g.AH)(n,i.id,f(e),e.headers.get("user-agent")||""),(0,g.aG)(f(e)),(0,p.z5)(i.id,e,n),await s._.user.update({where:{id:i.id},data:{lastLoginAt:new Date}}),(0,d.x_)({user:i,tokens:l,sessionId:n},"Login successful")}catch(r){return console.error("Login error:",r),(0,p.Ak)(e,r instanceof Error?r.message:"Unknown error",void 0),(0,d.jl)("Internal server error",500)}}function f(e){let r=e.headers.get("x-forwarded-for"),t=e.headers.get("x-real-ip"),a=e.headers.get("x-connecting-ip");return r?r.split(",")[0].trim():t||a||"unknown"}let x=(0,l.U)(m);async function v(e){return(0,d.jl)("Method not allowed",405)}let A=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/davicho/MASTER proyectos/FacePay/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:k,staticGenerationAsyncStorage:w,serverHooks:y}=A,q="/api/auth/login/route";function j(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},13538:(e,r,t)=>{t.d(r,{_:()=>o});var a=t(53524);let i=globalThis,o=i.prisma??=new a.PrismaClient({log:["query"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,1482,1585,5120,5252],()=>t(74381));module.exports=a})();