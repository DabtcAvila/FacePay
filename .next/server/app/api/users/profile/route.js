"use strict";(()=>{var e={};e.id=2807,e.ids=[2807],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},37077:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>k,requestAsyncStorage:()=>j,routeModule:()=>A,serverHooks:()=>q,staticGenerationAsyncStorage:()=>U});var s={};t.r(s),t.d(s,{DELETE:()=>v,GET:()=>I,PUT:()=>w,dynamic:()=>x});var u=t(49303),i=t(88716),o=t(60670),a=t(13538),n=t(2095),d=t(62065),l=t(1741),c=t(43258),p=t(89557),f=t(26033);async function m(e){try{let r=await (0,c.mk)(e);if(r.error)return r.error;if(!(0,c.Fs)(r.user,"read:own_profile"))return(0,p.Lu)(e,"Unauthorized profile access attempt",r.user.userId,p.V6.MEDIUM),(0,n.jl)("Insufficient permissions",403);let t=await a._.user.findUnique({where:{id:r.user.userId},select:{id:!0,email:!0,name:!0,createdAt:!0,updatedAt:!0,biometricData:{where:{isActive:!0},select:{id:!0,type:!0,createdAt:!0,isActive:!0}},paymentMethods:{select:{id:!0,type:!0,provider:!0,isDefault:!0,createdAt:!0}},_count:{select:{transactions:!0}}}});if(!t)return(0,n.jl)("User not found",404);return(0,n.x_)(t)}catch(e){return console.error("Get profile error:",e),(0,n.jl)("Internal server error",500)}}async function h(e){try{let r=await (0,c.mk)(e);if(r.error)return r.error;if(!(0,c.Fs)(r.user,"update:own_profile"))return(0,p.Lu)(e,"Unauthorized profile update attempt",r.user.userId,p.V6.MEDIUM),(0,n.jl)("Insufficient permissions",403);if((0,p.k_)(e).shouldBlock)return(0,p.Lu)(e,"Profile update blocked due to security threats",r.user.userId,p.V6.HIGH),(0,n.jl)("Request blocked due to security concerns",403);let t=await (0,l.$F)(e);if(t.error)return t.error;let{name:s,email:u}=t.data;if(u&&await a._.user.findFirst({where:{email:u,NOT:{id:r.user.userId}}}))return(0,n.jl)("Email is already taken",409);let i=await a._.user.update({where:{id:r.user.userId},data:{...s&&{name:s},...u&&{email:u}},select:{id:!0,email:!0,name:!0,createdAt:!0,updatedAt:!0}});return(0,n.x_)(i,"Profile updated successfully")}catch(e){if(e instanceof f.jm)return(0,n.jl)(e.errors[0].message,400);return console.error("Update profile error:",e),(0,n.jl)("Internal server error",500)}}async function y(e){let r=null;try{if((r=await (0,c.mk)(e)).error)return r.error;if(!(0,c.Fs)(r.user,"delete:own_account"))return(0,p.Lu)(e,"Unauthorized account deletion attempt",r.user.userId,p.V6.HIGH),(0,n.jl)("Insufficient permissions",403);if(r.user.needsRefresh)return(0,p.Lu)(e,"Account deletion attempted with stale token",r.user.userId,p.V6.HIGH),(0,n.jl)("Fresh authentication required for account deletion",401);return console.log(`[Security] Account deletion requested by user ${r.user.userId}`),await a._.user.delete({where:{id:r.user.userId}}),(0,n.x_)(null,"Account deleted successfully")}catch(t){return console.error("Delete account error:",t),(0,p.Lu)(e,"Account deletion failed",r?.user?.userId,p.V6.MEDIUM),(0,n.jl)("Internal server error",500)}}let I=(0,d.dU)(m),w=(0,d.dU)(h),v=(0,d.dU)(y),x="force-dynamic",A=new u.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/users/profile/route",pathname:"/api/users/profile",filename:"route",bundlePath:"app/api/users/profile/route"},resolvedPagePath:"/Users/davicho/MASTER proyectos/FacePay/src/app/api/users/profile/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:j,staticGenerationAsyncStorage:U,serverHooks:q}=A,_="/api/users/profile/route";function k(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:U})}},13538:(e,r,t)=>{t.d(r,{_:()=>i});var s=t(53524);let u=globalThis,i=u.prisma??=new s.PrismaClient({log:["query"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,1482,1585,5120,5252],()=>t(37077));module.exports=s})();