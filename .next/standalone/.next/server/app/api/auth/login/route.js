"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},4571:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>q,patchFetch:()=>R,requestAsyncStorage:()=>A,routeModule:()=>w,serverHooks:()=>k,staticGenerationAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{GET:()=>v,POST:()=>f,dynamic:()=>h});var n=t(49303),a=t(88716),i=t(60670),s=t(13538),u=t(75183),d=t(2095),c=t(62065),l=t(1741),p=t(89557),g=t(43258);let h="force-dynamic";async function m(e){try{if((0,p.k_)(e).shouldBlock)return(0,d.jl)("Request blocked due to security concerns",403);let r=await (0,l._D)(e);if(r.error)return r.error;let{email:t,password:o}=r.data,n=await s._B.user.findUnique({where:{email:t},select:{id:!0,email:!0,name:!0,createdAt:!0,updatedAt:!0}});if(!n)return(0,p.Ak)(e,"User not found",void 0),(0,g.Aj)(x(e)),(0,d.jl)("Invalid credentials",401);let a=p.kx.analyzeUserBehavior(n.id,e);a.riskScore>5&&(0,p.Ak)(e,`Anomalous login behavior detected: ${a.anomalies.join(", ")}`,n.id);let i=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),c=(0,u.X8)(n);return(0,g.AH)(i,n.id,x(e),e.headers.get("user-agent")||""),(0,g.aG)(x(e)),(0,p.z5)(n.id,e,i),await s._B.user.update({where:{id:n.id},data:{lastLoginAt:new Date}}),(0,d.x_)({user:n,tokens:c,sessionId:i},"Login successful")}catch(r){return console.error("Login error:",r),(0,p.Ak)(e,r instanceof Error?r.message:"Unknown error",void 0),(0,d.jl)("Internal server error",500)}}function x(e){let r=e.headers.get("x-forwarded-for"),t=e.headers.get("x-real-ip"),o=e.headers.get("x-connecting-ip");return r?r.split(",")[0].trim():t||o||"unknown"}let f=(0,c.U)(m);async function v(e){return(0,d.jl)("Method not allowed",405)}let w=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/davicho/MASTER proyectos/FacePay/src/app/api/auth/login/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:A,staticGenerationAsyncStorage:y,serverHooks:k}=w,q="/api/auth/login/route";function R(){return(0,i.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:y})}},13538:(e,r,t)=>{t.d(r,{_B:()=>i});var o=t(53524);let n=globalThis,a=process.env.DATABASE_URL,i=n.prisma??=new o.PrismaClient({log:["error","warn"],datasources:{db:{url:a}},...!1,errorFormat:"minimal"});i.$on("query",e=>{e.duration>1e3&&console.warn(`[SLOW QUERY] ${e.duration}ms: ${e.query}`)}),i.$on("error",e=>{console.error("[PRISMA ERROR]:",e)}),process.on("beforeExit",async()=>{await i.$disconnect()}),process.on("SIGINT",async()=>{await i.$disconnect(),process.exit(0)}),process.on("SIGTERM",async()=>{await i.$disconnect(),process.exit(0)})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8948,5972,1482,1585,5120,5252],()=>t(4571));module.exports=o})();