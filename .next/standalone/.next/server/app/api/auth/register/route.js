"use strict";(()=>{var e={};e.id=3002,e.ids=[3002],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},72459:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>T,patchFetch:()=>w,requestAsyncStorage:()=>x,routeModule:()=>R,serverHooks:()=>y,staticGenerationAsyncStorage:()=>v});var a={};t.r(a),t.d(a,{POST:()=>_,dynamic:()=>f});var s=t(49303),i=t(88716),n=t(60670),o=t(13538),u=t(48576),c=t(75183),d=t(2095),l=t(60526),m=t(98682),p=t(91585),g=t(26033);let f="force-dynamic",h=p.Ry({email:p.Z_().email("Invalid email address"),name:p.Z_().min(2,"Name must be at least 2 characters"),password:p.Z_().min(8,"Password must be at least 8 characters")});async function _(e){let r,t;let a=Date.now();try{r=e.headers.get("user-agent")||void 0,t=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||void 0,l.co.trackFunnelStep(l.T7.REGISTRATION,"registration_started",1,{user_agent:r,ip_address:t,timestamp:new Date().toISOString()});let s=await e.json();l.co.trackFunnelStep(l.T7.REGISTRATION,"form_submitted",2,{has_name:!!s.name,has_email:!!s.email,has_password:!!s.password});let{email:i,name:n,password:p}=h.parse(s);if(await o._B.user.findUnique({where:{email:i}}))return l.co.track("Registration Failed",{reason:"user_already_exists",email_domain:i.split("@")[1],funnel:l.T7.REGISTRATION,step:"validation"}),m.Rc.addBreadcrumb(`Registration attempt for existing user: ${i}`,"registration","warning",{email:i,userAgent:r,userIP:t}),(0,d.jl)("User already exists with this email",409);l.co.trackFunnelStep(l.T7.REGISTRATION,"validation_passed",3,{email_domain:i.split("@")[1],name_length:n.length}),await (0,u.c_)(p);let g=await o._B.user.create({data:{email:i,name:n},select:{id:!0,email:!0,name:!0,createdAt:!0,updatedAt:!0}}),f=(0,c.X8)(g);return l.co.trackFunnelStep(l.T7.REGISTRATION,"registration_completed",4,{user_id:g.id,email_domain:i.split("@")[1],registration_method:"email_password"}),l.co.trackUserRegistration("email",{user_id:g.id,email:g.email,name:g.name,registration_timestamp:g.createdAt,completion_time_ms:Date.now()-a}),l.co.identify(g.id,{email:g.email,name:g.name,created_at:g.createdAt,registration_method:"email_password"}),m.Rc.setUser({id:g.id,email:g.email,username:g.name||g.email}),m.Rc.addBreadcrumb(`User registered successfully: ${g.email}`,"registration","info",{userId:g.id,email:g.email}),m.Rc.trackPerformanceMetric("user_registration",Date.now()-a,{success:!0,method:"email_password"}),(0,d.x_)({user:g,tokens:f},"User registered successfully")}catch(s){let e=Date.now()-a;if(s instanceof g.jm)return l.co.track("Registration Failed",{reason:"validation_error",error_message:s.errors[0].message,error_field:s.errors[0].path.join("."),funnel:l.T7.REGISTRATION,step:"validation"}),m.Rc.captureMessage(`Registration validation error: ${s.errors[0].message}`,"warning",{extra:{validation_errors:s.errors,user_agent:r,ip_address:t,duration:e}}),(0,d.jl)(s.errors[0].message,400);return l.co.track("Registration Failed",{reason:"system_error",error_message:s.message,funnel:l.T7.REGISTRATION,step:"user_creation"}),m.Rc.captureException(s,{extra:{context:"user_registration",user_agent:r,ip_address:t,duration:e},tags:{endpoint:"/api/auth/register",operation:"user_registration"}}),console.error("Registration error:",s),(0,d.jl)("Internal server error",500)}}let R=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/Users/davicho/MASTER proyectos/FacePay/src/app/api/auth/register/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:v,serverHooks:y}=R,T="/api/auth/register/route";function w(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:v})}},2095:(e,r,t)=>{t.d(r,{jl:()=>o,mk:()=>n,x_:()=>u});var a=t(87070),s=t(75183),i=t(13538);async function n(e){let r=e.headers.get("authorization"),t=(0,s.oA)(r);if(!t)return{user:null,error:a.NextResponse.json({success:!1,error:"Authorization token required"},{status:401})};let n=(0,s.ez)(t);return n?await i._B.user.findUnique({where:{id:n.userId}})?{user:n,error:null}:{user:null,error:a.NextResponse.json({success:!1,error:"User not found"},{status:401})}:{user:null,error:a.NextResponse.json({success:!1,error:"Invalid or expired token"},{status:401})}}function o(e,r=400){return a.NextResponse.json({success:!1,error:e},{status:r})}function u(e,r){return a.NextResponse.json({success:!0,data:e,message:r})}},48576:(e,r,t)=>{t.d(r,{c_:()=>c,ow:()=>u,q6:()=>o});var a=t(6113),s=t.n(a);let i=process.env.ENCRYPTION_KEY||"your-32-byte-encryption-key-here",n="aes-256-gcm";function o(e){let r=s().randomBytes(12),t=s().createCipheriv(n,Buffer.from(i,"utf8").subarray(0,32),r),a=t.update(e,"utf8","hex");a+=t.final("hex");let o=t.getAuthTag();return{encrypted:a,iv:r.toString("hex"),tag:o.toString("hex")}}function u(e){let r=Buffer.from(e.iv,"hex"),t=s().createDecipheriv(n,Buffer.from(i,"utf8").subarray(0,32),r);return t.setAuthTag(Buffer.from(e.tag,"hex")),t.update(e.encrypted,"hex","utf8")+t.final("utf8")}function c(e){return new Promise((r,a)=>{t(42023).hash(e,12,(e,t)=>{e?a(e):r(t)})})}},75183:(e,r,t)=>{t.d(r,{X8:()=>o,ez:()=>u,oA:()=>d,si:()=>c});var a=t(41482),s=t.n(a);let i=process.env.JWT_SECRET||"your-secret-key",n=process.env.JWT_REFRESH_SECRET||"your-refresh-secret-key";function o(e){let r={userId:e.id,email:e.email};return{accessToken:s().sign(r,i,{expiresIn:"15m"}),refreshToken:s().sign(r,n,{expiresIn:"7d"}),expiresIn:900}}function u(e){try{return s().verify(e,i)}catch(e){return null}}function c(e){try{return s().verify(e,n)}catch(e){return null}}function d(e){return e&&e.startsWith("Bearer ")?e.substring(7):null}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,1482,1585,2023,7],()=>t(72459));module.exports=a})();