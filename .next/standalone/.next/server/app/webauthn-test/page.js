(()=>{var e={};e.id=3523,e.ids=[3523],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},74265:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>o}),s(77229),s(79286),s(7629),s(12523);var a=s(23191),i=s(88716),r=s(37922),n=s.n(r),l=s(95231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let o=["",{children:["webauthn-test",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,77229)),"/Users/davicho/MASTER proyectos/FacePay/src/app/webauthn-test/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,79286)),"/Users/davicho/MASTER proyectos/FacePay/src/app/layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,7629)),"/Users/davicho/MASTER proyectos/FacePay/src/app/error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,12523)),"/Users/davicho/MASTER proyectos/FacePay/src/app/not-found.tsx"]}],d=["/Users/davicho/MASTER proyectos/FacePay/src/app/webauthn-test/page.tsx"],m="/webauthn-test/page",u={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/webauthn-test/page",pathname:"/webauthn-test",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},97143:(e,t,s)=>{Promise.resolve().then(s.bind(s,81899))},66697:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]])},98360:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]])},51896:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},71208:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]])},12714:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},81538:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]])},3634:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},81899:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var a=s(10326),i=s(17577),r=s(36402),n=s(30058),l=s(98360),c=s(51896),o=s(60763),d=s(12714),m=s(30361),u=s(81538),h=s(66697),x=s(71208),p=s(41291),g=s(21405),f=s(94019),y=s(3634),b=s(91664);function j({onScanComplete:e,onCancel:t,userId:s,userName:r,enableWebAuthnFallback:j=!0,confidenceThreshold:v=.8,maxDetectionTime:N=1e4,enablePerformanceMetrics:w=!0}){let A=(0,i.useRef)(null),R=(0,i.useRef)(null),E=(0,i.useRef)(null),S=(0,i.useRef)(),D=(0,i.useRef)(),T=(0,i.useRef)(),[C,P]=(0,i.useState)("ready"),[I,k]=(0,i.useState)(0),[O,F]=(0,i.useState)(""),[M,_]=(0,i.useState)(0),[$,U]=(0,i.useState)(!1),[Z,q]=(0,i.useState)(!1),[L,W]=(0,i.useState)(null),[z,B]=(0,i.useState)({modelLoadTime:0,detectionTime:0,totalProcessingTime:0,framesProcessed:0,averageConfidence:0,detectionCount:0}),K=(0,i.useRef)([]),H=(0,i.useRef)(0),V=(0,i.useCallback)(async()=>{if(!Z){P("loading-models"),_(0),T.current=performance.now();try{await new Promise(e=>setTimeout(e,300)),_(50),await new Promise(e=>setTimeout(e,200)),_(100);let e=performance.now()-(T.current||0);B(t=>({...t,modelLoadTime:e})),q(!0)}catch(e){console.error("Error initializing simple face detection:",e),F("Failed to initialize face detection service."),q(!1)}}},[Z]),G=(0,i.useCallback)(async()=>{P("initializing-camera");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("Camera not supported in this browser");let e=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640,min:480},height:{ideal:480,min:360},facingMode:"user",frameRate:{ideal:30,min:15}},audio:!1});A.current&&(A.current.srcObject=e,E.current=e,A.current.playsInline=!0,A.current.muted=!0,await new Promise(e=>{A.current.onloadedmetadata=e}),await A.current.play(),U(!0))}catch(e){console.error("Camera initialization error:",e),F("Failed to access camera. Please check permissions."),P("error")}},[]),J=(0,i.useCallback)(async()=>{if(!A.current||!R.current)return{detected:!1,confidence:0};let e=A.current,t=R.current,s=t.getContext("2d");t.width=e.videoWidth||640,t.height=e.videoHeight||480,s.drawImage(e,0,0,t.width,t.height),H.current++;try{let e=performance.now(),a=s.getImageData(0,0,t.width,t.height),i=Y(a),r=performance.now()-e;if(B(e=>({...e,detectionTime:r,framesProcessed:H.current})),i){let e=Math.min(.95,.75+.15*Math.random()),a=t.width/2,i=t.height/2,r=.35*t.width,n=.45*t.height,l={x:a-r/2,y:i-n/2,width:r,height:n};s.strokeStyle=e>v?"#10B981":"#F59E0B",s.lineWidth=3,s.strokeRect(l.x,l.y,l.width,l.height),s.fillStyle="#FFFFFF",s.fillRect(l.x,l.y-25,120,25),s.fillStyle="#000000",s.font="14px Arial",s.fillText(`${(100*e).toFixed(1)}%`,l.x+5,l.y-8),K.current.push(e),K.current.length>30&&K.current.shift();let c=K.current.reduce((e,t)=>e+t,0)/K.current.length;return B(t=>({...t,averageConfidence:c,detectionCount:t.detectionCount+(e>v?1:0)})),{detected:e>v,confidence:e,boundingBox:l}}}catch(e){console.error("Face detection error:",e)}return{detected:!1,confidence:0}},[Z,v]),Y=(0,i.useCallback)(e=>{let t=e.data,s=0,a=t.length/4;for(let e=0;e<t.length;e+=40){let a=t[e],i=t[e+1],r=t[e+2];a>80&&i>50&&r>40&&a>i&&a>r&&s++}return s/(a/10)>.1},[]),X=(0,i.useCallback)(async()=>{if(!$)return;P("detecting"),k(0),D.current=performance.now();let t=async()=>{if("complete"===C||"error"===C)return;let s=await J();if(W(s),s.detected&&s.confidence>v){P("verifying"),k(100),setTimeout(()=>{P("complete");let t=performance.now()-(D.current||0);B(e=>({...e,totalProcessingTime:t})),e?.("simple",s.confidence)},1500);return}let a=performance.now()-(D.current||0);if(k(Math.min(a/N*100,95)),a>N){P("error"),F("Face detection timeout. Please try again.");return}S.current=requestAnimationFrame(t)};t()},[$,C,J,v,N,e]),Q=(0,i.useCallback)(async()=>{F(""),k(0);try{await V(),await G(),await X()}catch(e){console.error("Face ID process error:",e),F("Face ID initialization failed. Please try again."),P("error")}},[V,G,X]),ee=(0,i.useCallback)(()=>{E.current&&(E.current.getTracks().forEach(e=>e.stop()),E.current=null),S.current&&cancelAnimationFrame(S.current),U(!1)},[]);return(0,a.jsxs)("div",{className:"w-full max-w-2xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx(n.E.h2,{className:"text-2xl font-bold text-gray-900",animate:{color:"complete"===C?"#059669":"#1F2937"},children:"Simple Face ID Authentication"}),(0,a.jsxs)(n.E.div,{className:"flex items-center space-x-1 text-sm px-3 py-1 rounded-full",animate:{backgroundColor:"complete"===C?"#D1FAE5":"error"===C?"#FEE2E2":"loading-models"===C?"#EFF6FF":"#F3E8FF",color:"complete"===C?"#059669":"error"===C?"#DC2626":"loading-models"===C?"#3B82F6":"#8B5CF6"},children:["loading-models"===C&&a.jsx(l.Z,{className:"w-3 h-3"}),"initializing-camera"===C&&a.jsx(c.Z,{className:"w-3 h-3"}),("detecting"===C||"verifying"===C)&&a.jsx(d.Z,{className:"w-3 h-3"}),"complete"===C&&a.jsx(m.Z,{className:"w-3 h-3"}),"error"===C&&a.jsx(p.Z,{className:"w-3 h-3"}),a.jsx("span",{className:"text-xs font-medium",children:"ready"===C?"Ready":"loading-models"===C?"Loading AI":"initializing-camera"===C?"Camera Setup":"detecting"===C?"Scanning":"verifying"===C?"Verifying":"complete"===C?"Success":"Error"})]})]}),a.jsx(b.z,{onClick:()=>{ee(),t?.()},variant:"ghost",size:"sm",children:a.jsx(f.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-8",children:["ready"===C&&(0,a.jsxs)("div",{className:"text-center space-y-6",children:[a.jsx(n.E.div,{className:"w-32 h-32 mx-auto bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg",whileHover:{scale:1.05},whileTap:{scale:.95},children:a.jsx(d.Z,{className:"w-16 h-16 text-white"})}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Simple Face Detection"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Experience fast and lightweight face detection with real-time analysis"}),(0,a.jsxs)(b.z,{onClick:Q,className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700",children:[a.jsx(y.Z,{className:"w-4 h-4 mr-2"}),"Start Face ID Scan"]})]})]}),("loading-models"===C||"initializing-camera"===C)&&(0,a.jsxs)("div",{className:"text-center space-y-6",children:[(0,a.jsxs)(n.E.div,{className:"w-24 h-24 mx-auto bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg",animate:{scale:[1,1.05,1],rotate:[0,5,-5,0]},transition:{scale:{duration:1.5,repeat:1/0},rotate:{duration:2,repeat:1/0}},children:["loading-models"===C?a.jsx(l.Z,{className:"w-12 h-12 text-white"}):a.jsx(c.Z,{className:"w-12 h-12 text-white"}),a.jsx(n.E.div,{className:"absolute inset-0 w-24 h-24 border-3 border-transparent border-t-white/50 rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"loading-models"===C?"Loading AI Models":"Initializing Camera"}),a.jsx("p",{className:"text-gray-600",children:"loading-models"===C?"Initializing simple face detection system...":"Setting up camera for face scanning..."}),"loading-models"===C&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx(n.E.div,{className:"h-full bg-gradient-to-r from-blue-500 to-purple-600 rounded-full",initial:{width:"0%"},animate:{width:`${M}%`},transition:{duration:.3,ease:"easeOut"}})}),(0,a.jsxs)("div",{className:"text-sm text-blue-600 font-medium",children:[M,"% Complete"]})]})]})]}),("detecting"===C||"verifying"===C)&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"relative bg-gradient-to-br from-blue-900 to-purple-900 rounded-2xl overflow-hidden aspect-[4/3] flex items-center justify-center",children:[a.jsx("video",{ref:A,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}),a.jsx("canvas",{ref:R,className:"absolute inset-0 w-full h-full",style:{transform:"scaleX(-1)"}}),"detecting"===C&&a.jsx(n.E.div,{className:"absolute inset-8 border-2 border-blue-400 rounded-2xl pointer-events-none",animate:{borderColor:L?.detected?"#10B981":"#3B82F6",scale:[1,1.01,1]},transition:{duration:2,repeat:1/0},children:[0,1,2,3].map(e=>a.jsx("div",{className:`absolute w-6 h-6 ${0===e?"-top-1 -left-1":1===e?"-top-1 -right-1":2===e?"-bottom-1 -left-1":"-bottom-1 -right-1"}`,children:a.jsx(n.E.div,{className:`w-full h-full rounded-full ${L?.detected?"bg-green-400":"bg-blue-400"}`,animate:{scale:[1,1.2,1],opacity:[1,.7,1]},transition:{duration:1.5,repeat:1/0,delay:.2*e}})},e))}),"detecting"===C&&a.jsx(n.E.div,{className:"absolute left-8 right-8 h-0.5 bg-gradient-to-r from-transparent via-blue-400 to-transparent pointer-events-none",animate:{y:[32,"75%"]},transition:{duration:2,repeat:1/0,ease:"linear"}})]}),("detecting"===C||"verifying"===C)&&(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-2 overflow-hidden",children:a.jsx(n.E.div,{className:`h-full rounded-full ${"verifying"===C?"bg-gradient-to-r from-green-500 to-green-600":"bg-gradient-to-r from-blue-500 to-blue-600"}`,initial:{width:"0%"},animate:{width:`${I}%`},transition:{duration:.3,ease:"easeOut"},children:a.jsx(n.E.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent",animate:{x:[-100,100]},transition:{duration:1,repeat:1/0,ease:"linear"}})})}),a.jsx("div",{className:"text-center text-sm font-medium text-blue-600",children:"detecting"===C?`Scanning... ${Math.round(I)}%`:"Verifying identity..."})]}),a.jsx("div",{className:"text-center space-y-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:["verifying"===C?a.jsx(n.E.div,{animate:{rotate:360,scale:[1,1.1,1]},transition:{rotate:{duration:2,repeat:1/0,ease:"linear"},scale:{duration:1,repeat:1/0}},children:a.jsx(o.Z,{className:"w-7 h-7 text-green-500"})}):a.jsx(n.E.div,{animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0},children:a.jsx(d.Z,{className:"w-7 h-7 text-blue-500"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-lg font-semibold",children:["detecting"===C&&"Position your face in the frame","verifying"===C&&"Verifying your identity..."]}),L&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Confidence: ",(100*L.confidence).toFixed(1),"%"]})]})]})})]}),"complete"===C&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center space-y-6",children:[a.jsx(n.E.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:12,delay:.2},className:"mb-4",children:a.jsx(m.Z,{className:"w-24 h-24 text-green-500 mx-auto"})}),a.jsx(n.E.h3,{className:"text-2xl font-bold text-green-800",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:"Face ID Successful!"}),a.jsx(n.E.p,{className:"text-green-700",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},children:"Your identity has been verified using simple face detection."}),w&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"grid grid-cols-2 gap-4 text-sm text-gray-600 bg-green-50 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(u.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Detection: ",Math.round(z.totalProcessingTime),"ms"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(h.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Confidence: ",(100*z.averageConfidence).toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(x.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Frames: ",z.framesProcessed]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(l.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Model Load: ",Math.round(z.modelLoadTime),"ms"]})]})]})]}),"error"===C&&(0,a.jsxs)("div",{className:"text-center space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-3 text-red-500",children:[a.jsx(p.Z,{className:"w-8 h-8"}),a.jsx("h3",{className:"text-xl font-semibold",children:"Face ID Failed"})]}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsx("p",{className:"text-red-700 font-medium",children:O})}),(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"Don't worry! You can try again or use alternative authentication methods."}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,a.jsxs)(b.z,{onClick:Q,className:"flex items-center",children:[a.jsx(g.Z,{className:"w-4 h-4 mr-2"}),"Try Again"]}),j&&(0,a.jsxs)(b.z,{variant:"outline",className:"flex items-center",children:[a.jsx(o.Z,{className:"w-4 h-4 mr-2"}),"Use Biometric Auth"]})]})]})]})]})]})}function v(){let[e,t]=(0,i.useState)(null),[s,n]=(0,i.useState)([]),[l,c]=(0,i.useState)(!0),[o,d]=(0,i.useState)(!1),[m,u]=(0,i.useState)(null),[h,x]=(0,i.useState)(!1),[p,g]=(0,i.useState)("test-user-"+Date.now()),[f,y]=(0,i.useState)("test@facepay.com"),[b,v]=(0,i.useState)("test"),[N,w]=(0,i.useState)(null),A=(e,t,s)=>{let a={timestamp:new Date,type:e,message:t,details:s};n(e=>[a,...e]),console.log(`[WebAuthn Test] ${e.toUpperCase()}: ${t}`,s)},R=async()=>{if(h)return S("registration");d(!0),u("Registration"),A("info",`Starting WebAuthn registration for user: ${f}`);try{A("info","Step 1: Requesting biometric registration options from API...");let e=await fetch("/api/webauthn/register/start",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json();throw Error(`Registration start failed: ${t.error}`)}let t=await e.json();A("success","Biometric registration options received (platform authenticator required)",t.data.options),A("info","Step 2: Creating biometric credential (platform authenticator required)...");let s=await navigator.credentials.create({publicKey:t.data.options});if(!s)throw Error("No credential created");A("success","Credential created successfully",{id:s.id,type:s.type}),A("info","Step 3: Verifying biometric registration with server...");let a=await fetch("/api/webauthn/register/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:{id:s.id,rawId:s.id,response:{attestationObject:s.response.attestationObject,clientDataJSON:s.response.clientDataJSON},type:s.type}})});if(!a.ok){let e=await a.json();throw Error(`Registration completion failed: ${e.error}`)}let i=await a.json();A("success","Biometric registration completed successfully! Platform authenticator verified.",i)}catch(t){let e=r.G.handleWebAuthnError(t);A("error",`Registration failed: ${e.message}`,e)}finally{d(!1),u(null)}},E=async()=>{if(h)return S("authentication");d(!0),u("Authentication"),A("info",`Starting WebAuthn authentication for user: ${p}`);try{A("info","Step 1: Requesting biometric authentication options from API...");let e=await fetch("/api/webauthn/authenticate/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:p})});if(!e.ok){let t=await e.json();throw Error(`Authentication start failed: ${t.error}`)}let t=await e.json();A("success","Biometric authentication options received (user verification required)",t.data.options),A("info","Step 2: Getting biometric credential (user verification required)...");let s=await navigator.credentials.get({publicKey:t.data.options});if(!s)throw Error("No credential received");A("success","Credential retrieved successfully",{id:s.id,type:s.type}),A("info","Step 3: Verifying biometric authentication with server...");let a=await fetch("/api/webauthn/authenticate/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:{id:s.id,rawId:s.id,response:{authenticatorData:s.response.authenticatorData,clientDataJSON:s.response.clientDataJSON,signature:s.response.signature},type:s.type}})});if(!a.ok){let e=await a.json();throw Error(`Authentication completion failed: ${e.error}`)}let i=await a.json();A("success","Biometric authentication completed successfully! Platform authenticator verified.",i)}catch(t){let e=r.G.handleWebAuthnError(t);A("error",`Authentication failed: ${e.message}`,e)}finally{d(!1),u(null)}},S=async e=>{d(!0),u(`Demo ${e}`),A("info",`Starting demo ${e} simulation...`),await new Promise(e=>setTimeout(e,1e3)),A("info",`Simulating ${e} options request...`),await new Promise(e=>setTimeout(e,1500)),A("info",`Simulating biometric ${"registration"===e?"enrollment":"verification"}...`),await new Promise(e=>setTimeout(e,1e3)),A("success",`Demo ${e} completed successfully! (This was a simulation)`),d(!1),u(null)},D=async()=>{A("info","Starting comprehensive test suite..."),await new Promise(e=>setTimeout(e,500)),await R(),await new Promise(e=>setTimeout(e,1e3)),await E(),A("success","Full test suite completed!")};return l?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md mx-auto text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4 mx-auto"}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Initializing WebAuthn Test Suite"}),a.jsx("p",{className:"text-gray-600",children:"Checking device capabilities..."})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 py-6 px-4",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"WebAuthn Comprehensive Test Suite"}),a.jsx("p",{className:"text-gray-600 text-lg",children:"Complete testing environment for WebAuthn biometric authentication"}),a.jsx("div",{className:"mt-4",children:h?a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:"Demo Mode Active"}):(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:[e?e.biometricTypes.includes("face")?"\uD83D\uDD12":e.biometricTypes.includes("fingerprint")?"\uD83D\uDC46":e.deviceInfo.isIOS?"\uD83D\uDCF1":e.deviceInfo.isMacOS?"\uD83D\uDCBB":"\uD83D\uDD10":"\uD83D\uDD10"," ",e?e.biometricTypes.includes("face")?e.deviceInfo.isIOS?"Face ID":"Face Recognition":e.biometricTypes.includes("fingerprint")?e.deviceInfo.isIOS?"Touch ID":"Fingerprint":e.deviceInfo.isMacOS?"Touch ID":e.deviceInfo.isWindows?"Windows Hello":"Biometric Authentication":"Biometric Authentication"," Ready"]})})]}),a.jsx("div",{className:"flex justify-center mb-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-1 shadow-sm border",children:[a.jsx("button",{onClick:()=>v("test"),className:`px-4 py-2 rounded-md font-medium transition-colors ${"test"===b?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"}`,children:"WebAuthn Tests"}),a.jsx("button",{onClick:()=>v("face-id"),className:`px-4 py-2 rounded-md font-medium transition-colors ${"face-id"===b?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Real Face ID Tests"}),a.jsx("button",{onClick:()=>v("capabilities"),className:`px-4 py-2 rounded-md font-medium transition-colors ${"capabilities"===b?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Device Info"}),a.jsx("button",{onClick:()=>v("logs"),className:`px-4 py-2 rounded-md font-medium transition-colors ${"logs"===b?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Debug Logs"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-6",children:["test"===b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Test Configuration"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User ID"}),a.jsx("input",{type:"text",value:p,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User Name"}),a.jsx("input",{type:"email",value:f,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"demo-mode",checked:h,onChange:e=>x(e.target.checked),className:"mr-2",disabled:o}),a.jsx("label",{htmlFor:"demo-mode",className:"text-sm text-gray-700",children:"Force Demo Mode (simulated authentication)"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Test Actions"}),m&&a.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600 mr-3"}),(0,a.jsxs)("span",{className:"text-blue-800 font-medium",children:["Running: ",m]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[a.jsx("button",{onClick:R,disabled:o,className:"bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:o&&m?.includes("Registration")?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Testing..."]}):"Test Registration"}),a.jsx("button",{onClick:E,disabled:o,className:"bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:o&&m?.includes("Authentication")?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Testing..."]}):"Test Authentication"}),a.jsx("button",{onClick:D,disabled:o,className:"bg-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center sm:col-span-2",children:o?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Running Suite..."]}):"Run Full Test Suite"})]})]})]}),"face-id"===b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Real Face ID Testing"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-blue-800",children:[a.jsx("span",{className:"w-2 h-2 bg-blue-600 rounded-full"}),a.jsx("span",{className:"font-medium",children:"Simple Face Detection Test"})]}),a.jsx("p",{className:"text-blue-700 text-sm mt-1",children:"Test lightweight computer vision face detection with performance metrics"})]}),N&&(0,a.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[a.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Last Test Result"}),(0,a.jsxs)("div",{className:"text-sm text-green-700 space-y-1",children:[(0,a.jsxs)("p",{children:[a.jsx("strong",{children:"Method:"})," ",N.method]}),N.confidence&&(0,a.jsxs)("p",{children:[a.jsx("strong",{children:"Confidence:"})," ",(100*N.confidence).toFixed(1),"%"]}),(0,a.jsxs)("p",{children:[a.jsx("strong",{children:"Time:"})," ",N.timestamp.toLocaleString()]})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Live Face ID Test"}),a.jsx(j,{onScanComplete:(e,t)=>{let s={method:e,confidence:t,timestamp:new Date};w(s),A("success",`Face ID test completed using ${e}`,s)},onCancel:()=>{A("info","Face ID test cancelled by user")},userId:p,userName:f,enableWebAuthnFallback:!0,confidenceThreshold:.7,maxDetectionTime:15e3,enablePerformanceMetrics:!0})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Performance Testing Features"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Real-time simple face detection"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Skin color detection algorithms"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Basic feature detection"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Confidence threshold testing"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Performance metrics collection"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Fallback detection algorithms"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Real-time video processing"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Error handling and recovery"]})]})]})]})]}),"capabilities"===b&&e&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Device Capabilities"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"WebAuthn Support"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[a.jsx("span",{className:"text-sm text-gray-700",children:"WebAuthn API"}),a.jsx("span",{className:`text-sm font-medium ${e.isSupported?"text-green-600":"text-red-600"}`,children:e.isSupported?"✓ Supported":"✗ Not Supported"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[a.jsx("span",{className:"text-sm text-gray-700",children:"Platform Authenticator"}),a.jsx("span",{className:`text-sm font-medium ${e.isPlatformAuthenticatorAvailable?"text-green-600":"text-red-600"}`,children:e.isPlatformAuthenticatorAvailable?"✓ Available":"✗ Not Available"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[a.jsx("span",{className:"text-sm text-gray-700",children:"User Verification"}),a.jsx("span",{className:`text-sm font-medium ${e.isPlatformAuthenticatorAvailable?"text-green-600":"text-red-600"}`,children:e.isPlatformAuthenticatorAvailable?"✓ Supported":"✗ Not Supported"})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Biometric Capabilities"}),a.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:e.biometricTypes.length>0?a.jsx("div",{className:"flex flex-wrap gap-2",children:e.biometricTypes.map((e,t)=>(0,a.jsxs)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:["face"===e&&"\uD83D\uDD12","fingerprint"===e&&"\uD83D\uDC46","voice"===e&&"\uD83C\uDFA4","unknown"===e&&"\uD83D\uDD10",e.charAt(0).toUpperCase()+e.slice(1)]},t))}):a.jsx("span",{className:"text-gray-500",children:"No biometric types detected"})})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Device Information"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Platform"}),a.jsx("span",{className:"text-sm font-medium",children:e.deviceInfo.platform})]}),(0,a.jsxs)("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Device Type"}),a.jsx("span",{className:"text-sm font-medium",children:e.deviceInfo.isMobile?"Mobile":"Desktop"})]}),(0,a.jsxs)("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Operating System"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[e.deviceInfo.isIOS&&"iOS",e.deviceInfo.isAndroid&&"Android",e.deviceInfo.isMacOS&&"macOS",e.deviceInfo.isWindows&&"Windows",!e.deviceInfo.isIOS&&!e.deviceInfo.isAndroid&&!e.deviceInfo.isMacOS&&!e.deviceInfo.isWindows&&"Other"]})]}),(0,a.jsxs)("div",{className:"pt-2",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"User Agent"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1 break-all",children:"undefined"!=typeof navigator?navigator.userAgent:"Server Side"})]})]})]})]})]}),"logs"===b&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Debug Logs"}),a.jsx("button",{onClick:()=>{n([]),A("info","Test logs cleared")},className:"text-sm text-gray-500 hover:text-gray-700 px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-50",children:"Clear Logs"})]}),a.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===s.length?a.jsx("p",{className:"text-gray-500 text-center py-4",children:"No logs yet. Run some tests to see debug information."}):s.map((e,t)=>a.jsx("div",{className:`p-3 rounded-lg border-l-4 ${"error"===e.type?"bg-red-50 border-red-400":"warning"===e.type?"bg-yellow-50 border-yellow-400":"success"===e.type?"bg-green-50 border-green-400":"bg-blue-50 border-blue-400"}`,children:a.jsx("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:`text-xs font-medium ${"error"===e.type?"text-red-600":"warning"===e.type?"text-yellow-600":"success"===e.type?"text-green-600":"text-blue-600"}`,children:e.type.toUpperCase()}),a.jsx("span",{className:"text-xs text-gray-500",children:e.timestamp.toLocaleTimeString()})]}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:e.message}),e.details&&(0,a.jsxs)("details",{className:"mt-2",children:[a.jsx("summary",{className:"text-xs text-gray-600 cursor-pointer hover:text-gray-800",children:"View Details"}),a.jsx("pre",{className:"text-xs bg-gray-100 p-2 mt-1 rounded overflow-x-auto",children:JSON.stringify(e.details,null,2)})]})]})})},t))})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Status"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700",children:"WebAuthn Support"}),a.jsx("span",{className:`text-sm font-medium ${e?.isSupported?"text-green-600":"text-red-600"}`,children:e?.isSupported?"Supported":"Not Supported"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700",children:"Biometric Authentication"}),a.jsx("span",{className:`text-sm font-medium ${e?.isPlatformAuthenticatorAvailable?"text-green-600":"text-red-600"}`,children:e?.isPlatformAuthenticatorAvailable?"Available":"Not Available"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700",children:"Face ID Test"}),a.jsx("span",{className:`text-sm font-medium ${N?"text-green-600":"text-gray-500"}`,children:N?"Tested":"Not Tested"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700",children:"Test Mode"}),a.jsx("span",{className:`text-sm font-medium ${h?"text-blue-600":"text-green-600"}`,children:h?"Demo Mode":"Live Mode"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-700",children:"Total Tests Run"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.filter(e=>e.message.includes("completed successfully")).length})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Test Suite Features"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Comprehensive device capability detection"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Full WebAuthn registration testing"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Full WebAuthn authentication testing"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Real Face ID with Simple Detection"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Computer vision face detection"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Performance metrics collection"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Detailed debug logging and error handling"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Demo mode for unsupported devices"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Cross-platform biometric detection"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Professional testing interface"]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-500 mr-2",children:"✓"}),"Real-time test monitoring"]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Technical Notes"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-2",children:[a.jsx("p",{children:"• This test suite provides comprehensive WebAuthn functionality testing"}),a.jsx("p",{children:"• Real Face ID uses simple computer vision with skin color detection"}),a.jsx("p",{children:"• All tests are logged with detailed debugging information and performance metrics"}),a.jsx("p",{children:"• Demo mode simulates authentication flow for development"}),a.jsx("p",{children:"• Real biometric data is only processed on supported devices"}),a.jsx("p",{children:"• Face ID includes fallback detection algorithms for reliability"}),a.jsx("p",{children:"• Tests cover registration, authentication, face detection, and error scenarios"})]})]})]})]})]})})}},77229:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>r,default:()=>l});var a=s(68570);let i=(0,a.createProxy)(String.raw`/Users/davicho/MASTER proyectos/FacePay/src/app/webauthn-test/page.tsx`),{__esModule:r,$$typeof:n}=i;i.default;let l=(0,a.createProxy)(String.raw`/Users/davicho/MASTER proyectos/FacePay/src/app/webauthn-test/page.tsx#default`)},17602:(e,t,s)=>{"use strict";function a(e){let t=new Uint8Array(e),s="";for(let e of t)s+=String.fromCharCode(e);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function i(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),s=(4-t.length%4)%4,a=atob(t.padEnd(t.length+s,"=")),i=new ArrayBuffer(a.length),r=new Uint8Array(i);for(let e=0;e<a.length;e++)r[e]=a.charCodeAt(e);return i}function r(){return window?.PublicKeyCredential!==void 0&&"function"==typeof window.PublicKeyCredential}function n(e){let{id:t}=e;return{...e,id:i(t),transports:e.transports}}function l(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}s.d(t,{RQ:()=>h,oz:()=>p});class c extends Error{constructor({message:e,code:t,cause:s,name:a}){super(e,{cause:s}),this.name=a??s.name,this.code=t}}class o{createNewAbortSignal(){if(this.controller){let e=Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}let d=new o,m=["cross-platform","platform"];function u(e){if(!(!e||0>m.indexOf(e)))return e}async function h(e){var t;let s,o,m,h,p;if(!r())throw Error("WebAuthn is not supported in this browser");let g={publicKey:{...e,challenge:i(e.challenge),user:{...e.user,id:(t=e.user.id,new TextEncoder().encode(t))},excludeCredentials:e.excludeCredentials?.map(n)}};g.signal=d.createNewAbortSignal();try{s=await navigator.credentials.create(g)}catch(e){throw function({error:e,options:t}){let{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new c({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(s.authenticatorSelection?.requireResidentKey===!0)return new c({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(s.authenticatorSelection?.userVerification==="required")return new c({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else if("InvalidStateError"===e.name)return new c({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});else if("NotAllowedError"===e.name)return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("NotSupportedError"===e.name)return new c(0===s.pubKeyCredParams.filter(e=>"public-key"===e.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!l(t))return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(s.rp.id!==t)return new c({message:`The RP ID "${s.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(s.user.id.byteLength<1||s.user.id.byteLength>64)return new c({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new c({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return e}({error:e,options:g})}if(!s)throw Error("Registration was not completed");let{id:f,rawId:y,response:b,type:j}=s;if("function"==typeof b.getTransports&&(m=b.getTransports()),"function"==typeof b.getPublicKeyAlgorithm)try{h=b.getPublicKeyAlgorithm()}catch(e){x("getPublicKeyAlgorithm()",e)}if("function"==typeof b.getPublicKey)try{let e=b.getPublicKey();null!==e&&(p=a(e))}catch(e){x("getPublicKey()",e)}if("function"==typeof b.getAuthenticatorData)try{o=a(b.getAuthenticatorData())}catch(e){x("getAuthenticatorData()",e)}return{id:f,rawId:a(y),response:{attestationObject:a(b.attestationObject),clientDataJSON:a(b.clientDataJSON),transports:m,publicKeyAlgorithm:h,publicKey:p,authenticatorData:o},type:j,clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:u(s.authenticatorAttachment)}}function x(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}async function p(e,t=!1){let s,o,m;if(!r())throw Error("WebAuthn is not supported in this browser");e.allowCredentials?.length!==0&&(s=e.allowCredentials?.map(n));let h={...e,challenge:i(e.challenge),allowCredentials:s},x={};if(t){if(!await function(){let e=window.PublicKeyCredential;return void 0===e.isConditionalMediationAvailable?new Promise(e=>e(!1)):e.isConditionalMediationAvailable()}())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');x.mediation="conditional",h.allowCredentials=[]}x.publicKey=h,x.signal=d.createNewAbortSignal();try{o=await navigator.credentials.get(x)}catch(e){throw function({error:e,options:t}){let{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new c({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("NotAllowedError"===e.name)return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!l(t))return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(s.rpId!==t)return new c({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new c({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return e}({error:e,options:x})}if(!o)throw Error("Authentication was not completed");let{id:p,rawId:g,response:f,type:y}=o;if(f.userHandle){var b;b=f.userHandle,m=new TextDecoder("utf-8").decode(b)}return{id:p,rawId:a(g),response:{authenticatorData:a(f.authenticatorData),clientDataJSON:a(f.clientDataJSON),signature:a(f.signature),userHandle:m},type:y,clientExtensionResults:o.getClientExtensionResults(),authenticatorAttachment:u(o.authenticatorAttachment)}}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,4185,5832,6402],()=>s(74265));module.exports=a})();