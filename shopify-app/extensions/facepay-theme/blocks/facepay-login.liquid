{% comment %}
  FacePay Biometric Login Block
  
  This block can be added to cart, product, or login pages
  to provide biometric authentication options.
{% endcomment %}

<div class="facepay-container" data-facepay-block>
  <div class="facepay-card">
    <div class="facepay-header">
      <svg class="facepay-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
      </svg>
      <h3>{{ block.settings.title | default: 'Express Checkout' }}</h3>
      <p>{{ block.settings.description | default: 'Authenticate with biometrics for faster checkout' }}</p>
    </div>

    <div class="facepay-buttons">
      {% if block.settings.enable_face_id %}
        <button 
          class="facepay-btn facepay-btn-primary" 
          id="facepay-face-id"
          data-method="face"
        >
          <svg class="facepay-btn-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-4.18C14.4 2.84 13.3 2 12 2c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-7-.25c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75zM19 20H5V6h14v14z"/>
          </svg>
          {{ block.settings.face_id_text | default: 'Use Face ID' }}
        </button>
      {% endif %}

      {% if block.settings.enable_webauthn %}
        <button 
          class="facepay-btn facepay-btn-secondary" 
          id="facepay-webauthn"
          data-method="webauthn"
        >
          <svg class="facepay-btn-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>
          </svg>
          {{ block.settings.webauthn_text | default: 'Use Device Auth' }}
        </button>
      {% endif %}
    </div>

    <div class="facepay-status" id="facepay-status" style="display: none;">
      <div class="facepay-loading">
        <div class="facepay-spinner"></div>
        <span id="facepay-status-text">Processing...</span>
      </div>
    </div>

    <div class="facepay-error" id="facepay-error" style="display: none;">
      <div class="facepay-error-content">
        <svg class="facepay-error-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
        </svg>
        <span id="facepay-error-text"></span>
      </div>
    </div>

    <div class="facepay-success" id="facepay-success" style="display: none;">
      <div class="facepay-success-content">
        <svg class="facepay-success-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        <span>Authentication successful!</span>
      </div>
    </div>
  </div>
</div>

<style>
  .facepay-container {
    margin: 1rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .facepay-card {
    border: 1px solid #e1e1e1;
    border-radius: 8px;
    padding: 1.5rem;
    background: #fff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  .facepay-header {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .facepay-icon {
    width: 48px;
    height: 48px;
    margin: 0 auto 1rem;
    display: block;
    color: {{ block.settings.brand_color | default: '#007aff' }};
  }

  .facepay-header h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: #1a1a1a;
  }

  .facepay-header p {
    margin: 0;
    color: #666;
    font-size: 0.875rem;
  }

  .facepay-buttons {
    display: flex;
    gap: 0.75rem;
    flex-direction: column;
  }

  .facepay-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    width: 100%;
  }

  .facepay-btn-primary {
    background: {{ block.settings.brand_color | default: '#007aff' }};
    color: white;
  }

  .facepay-btn-primary:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }

  .facepay-btn-secondary {
    background: #f8f9fa;
    color: #495057;
    border: 1px solid #dee2e6;
  }

  .facepay-btn-secondary:hover {
    background: #e9ecef;
  }

  .facepay-btn-icon {
    width: 20px;
    height: 20px;
  }

  .facepay-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .facepay-status,
  .facepay-error,
  .facepay-success {
    margin-top: 1rem;
    padding: 0.75rem;
    border-radius: 4px;
    text-align: center;
  }

  .facepay-status {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
  }

  .facepay-error {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
  }

  .facepay-success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
  }

  .facepay-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .facepay-spinner {
    width: 16px;
    height: 16px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid {{ block.settings.brand_color | default: '#007aff' }};
    border-radius: 50%;
    animation: facepay-spin 1s linear infinite;
  }

  @keyframes facepay-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .facepay-error-content,
  .facepay-success-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .facepay-error-icon,
  .facepay-success-icon {
    width: 16px;
    height: 16px;
  }

  @media (min-width: 768px) {
    .facepay-buttons {
      flex-direction: row;
    }
  }
</style>

{% schema %}
{
  "name": "FacePay Login",
  "target": "section",
  "available_if": "{{ app.metafields.facepay.enabled }}",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Express Checkout"
    },
    {
      "type": "textarea",
      "id": "description", 
      "label": "Description",
      "default": "Authenticate with biometrics for faster checkout"
    },
    {
      "type": "checkbox",
      "id": "enable_face_id",
      "label": "Enable Face ID",
      "default": true
    },
    {
      "type": "text",
      "id": "face_id_text",
      "label": "Face ID Button Text",
      "default": "Use Face ID"
    },
    {
      "type": "checkbox",
      "id": "enable_webauthn",
      "label": "Enable WebAuthn",
      "default": true
    },
    {
      "type": "text",
      "id": "webauthn_text",
      "label": "WebAuthn Button Text",
      "default": "Use Device Auth"
    },
    {
      "type": "color",
      "id": "brand_color",
      "label": "Brand Color",
      "default": "#007aff"
    }
  ],
  "presets": [
    {
      "name": "FacePay Login",
      "category": "Custom"
    }
  ]
}
{% endschema %}